apiVersion: apps/v1
kind: Deployment
metadata:
  name: thanos-query
  namespace: istio-system
  labels:
    app.kubernetes.io/name: thanos-query
spec:
  replicas: 1
  selector:
    matchLabels: #matches the labels in template:
      app.kubernetes.io/component: query-layer
      app.kubernetes.io/instance: thanos-query
      app.kubernetes.io/name: thanos-query
  template:
    metadata:
      annotations:
        sidecar.istio.io/rewriteAppHTTPProbers: "true"
      labels:
        app.kubernetes.io/component: query-layer
        app.kubernetes.io/instance: thanos-query
        app.kubernetes.io/name: thanos-query
    spec:
      containers:
      - name: thanos-query
        image: thanosio/thanos:v0.32.2
        args:
        - query
        - --query.auto-downsampling
        - --query.partial-response
        - --store=thanos-store.istio-system.svc.cluster.local:10901
        - --store=thanos-sidecar.istio-system.svc.cluster.local:10901
        volumeMounts:
        - name: thanos-config-volume
          mountPath: /etc/thanos
          readOnly: true
      volumes:
      - name: thanos-config-volume
        configMap:
          name: thanos-config
